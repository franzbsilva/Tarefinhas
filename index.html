<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cofre MÃ¡gico Kids ğŸš—</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div id="app">
        <section id="login-screen" class="card">
            <h1>ğŸŒŸ Cofre MÃ¡gico</h1>
            <div id="login-form">
                <input type="text" id="user" placeholder="E-mail do Pai ou Login do Filho" autocapitalize="none">
                <input type="password" id="pass" placeholder="Senha">
                <button onclick="handleLogin()" class="btn-login" id="btn-login-text">Entrar</button>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    Novo pai por aqui? <a href="#" onclick="toggleSignup()" style="color: var(--secondary);">Cadastre-se</a>
                </p>
            </div>

            <div id="signup-form" class="hidden">
                <h3 style="color: var(--secondary);">Criar Conta de Pai/MÃ£e</h3>
                <input type="email" id="new-parent-email" placeholder="Seu E-mail" autocapitalize="none">
                <input type="text" id="new-parent-phone" placeholder="Seu Telefone / WhatsApp">
                <input type="password" id="new-parent-pass" placeholder="Crie uma Senha (mÃ­nimo 6 letras)">

                <div class="terms-check">
                    <input type="checkbox" id="accept-terms">
                    <label for="accept-terms">Li e concordo com os <a href="#" onclick="openTerms()" style="color: var(--primary);">Termos de Uso e Privacidade</a>.</label>
                </div>

                <button onclick="registerParent()" class="btn-action">Solicitar Acesso</button>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    JÃ¡ tem conta? <a href="#" onclick="toggleSignup()" style="color: var(--danger);">Voltar ao Login</a>
                </p>
            </div>
            <p id="login-error" class="error hidden">Erro</p>
        </section>

        <section id="admin-panel" class="hidden card">
            <div class="top-bar">
                <h2>ğŸ‘¨â€ğŸ« Painel</h2>
                <button onclick="logout()" class="btn-logout">Sair ğŸšª</button>
            </div>

            <div class="tabs">
                <button id="btn-tab-filhos" onclick="switchTab('filhos')" class="tab-active">ğŸ‘¶ Meus Filhos</button>
                <button id="btn-tab-tarefas" onclick="switchTab('tarefas')">ğŸ“‹ Tarefas</button>
                <button id="btn-tab-superadmin" onclick="switchTab('superadmin')" class="hidden" style="color: purple; font-weight: bold;">ğŸ‘‘ Admin</button>
            </div>

            <div id="tab-superadmin" class="tab-content hidden">
                <div class="admin-section" style="background: #f3e5f5; border: 2px dashed purple;">
                    <h3 style="color: purple;">Aprovar Novos Pais</h3>
                    <p class="subtitle">Libere o acesso para os clientes cadastrados.</p>
                    <ul id="pending-parents-list" style="list-style: none; padding: 0;"></ul>
                </div>
            </div>

            <div id="tab-filhos" class="tab-content">
                <div class="admin-section">
                    <h3>â• Adicionar Filho</h3>
                    <input type="text" id="add-kid-name" placeholder="Nome da crianÃ§a">
                    <input type="text" id="add-kid-login" placeholder="Login para ela acessar" autocapitalize="none">
                    <input type="password" id="add-kid-pass" placeholder="Senha da crianÃ§a">
                    <button onclick="addKid()" class="btn-action">Criar Cofre</button>
                </div>

                <div class="admin-section" style="background: #fff; border: 2px dashed #ccc;">
                    <h3>âš™ï¸ Gerenciar Cofres</h3>
                    <select id="kid-selector" onchange="loadKidDataForAdmin()">
                        <option value="">Selecione um filho...</option>
                    </select>

                    <div id="admin-kid-details" class="hidden">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <div class="balance-card" style="flex: 1; margin: 0; padding: 10px;">
                                <span style="font-size: 14px; color:#666; display:block;">Total Guardado:</span>
                                <span id="admin-total-money" style="font-size: 20px;">R$ 0,00</span>
                            </div>
                            <div class="balance-card" style="flex: 1; margin: 0; padding: 10px; background: #fff3e0; border-color: #ff9800; color: #ff9800;">
                                <span style="font-size: 14px; color:#666; display:block;">Ganhos do MÃªs:</span>
                                <span id="admin-month-money" style="font-size: 20px;">R$ 0,00</span>
                            </div>
                        </div>

                        <div class="admin-section" style="background: #fdfdfd; border: 1px solid #ddd; margin-bottom: 20px;">
                            <h4 style="margin-top:0;">âœï¸ Editar Dados do Filho</h4>
                            <input type="text" id="edit-kid-name" placeholder="Nome da CrianÃ§a">
                            <input type="text" id="edit-kid-login" placeholder="Novo Login" autocapitalize="none">
                            <input type="text" id="edit-kid-pass" placeholder="Nova Senha">
                            <button onclick="updateKidData()" id="btn-update-kid" class="btn-action" style="background: var(--primary); color: #333;">Salvar AlteraÃ§Ãµes</button>
                        </div>

                        <div class="penalty-group">
                            <h4>âš ï¸ Dar Penalidade RÃ¡pida</h4>
                            <input type="text" id="penalty-desc" placeholder="Motivo (ex: DesobediÃªncia)">
                            <input type="text" id="penalty-val" placeholder="R$ 0,00" oninput="maskCurrency(this)">
                            <button onclick="applyPenaltyCustom()" class="btn-danger">Aplicar Desconto</button>
                        </div>
                        <div class="history-group">
                            <h4>ğŸ“œ HistÃ³rico de Hoje:</h4>
                            <div id="admin-daily-log" class="log-section"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-tarefas" class="tab-content hidden">
                <div class="admin-section" style="background: #e8f5e9;">
                    <h3>ğŸ“‹ Criar Nova Tarefa</h3>
                    <input type="text" id="new-task-desc" placeholder="Ex: Arrumar a cama">
                    <input type="text" id="new-task-val" placeholder="R$ 0,00" oninput="maskCurrency(this)">
                    <select id="new-task-type">
                        <option value="false">ğŸš€ Tarefa Extra</option>
                        <option value="true">âš¡ ObrigatÃ³ria (DiÃ¡ria)</option>
                    </select>
                    <button onclick="createAdminTask()" class="btn-action" style="background: var(--secondary);">Adicionar Tarefa</button>
                </div>
                <div style="text-align: left;">
                    <h4>Suas Tarefas Cadastradas:</h4>
                    <ul id="admin-task-list" style="list-style: none; padding: 0;"></ul>
                </div>
            </div>
        </section>

        <section id="filho-panel" class="hidden card">
            <div class="top-bar">
                <h2 id="filho-welcome">OlÃ¡! ğŸ†</h2>
                <button onclick="logout()" class="btn-logout">Sair ğŸšª</button>
            </div>
            <div class="balance-card">Meu Dinheirinho: <span id="total-money">R$ 0,00</span></div>

            <div id="penalty-section" class="task-section hidden" style="border-color: var(--danger);">
                <h3 style="color: var(--danger);">âš ï¸ O que preciso melhorar:</h3>
                <div id="penalty-list"></div>
            </div>
            <div id="history-section" class="task-section hidden" style="border-color: var(--secondary);">
                <h3 style="color: var(--secondary);">âœ… O que eu jÃ¡ fiz hoje:</h3>
                <div id="filho-daily-log"></div>
            </div>

            <div class="task-section">
                <h3>1. ObrigatÃ³rias âš¡</h3>
                <div id="obligatory-tasks"></div>
            </div>
            <div id="extra-section" class="task-section locked">
                <h3>2. Extras e Ajuda ğŸš€</h3>
                <div id="extra-tasks"></div>
            </div>
        </section>

        <footer class="app-footer">
            <p>&copy; 2026 Franz TI Services. Todos os direitos reservados.</p>
            <p><a href="#" onclick="openTerms()" style="color: #888; text-decoration: underline;">Termos de Uso e Privacidade</a></p>
            <a href="https://wa.me/5563981171079" target="_blank" class="btn-support">ğŸ§ Falar com Suporte</a>
        </footer>
    </div>

    <button id="btn-top" onclick="scrollToTop()">â¬†ï¸</button>

    <div id="custom-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="modal-icon" class="modal-icon">âœ¨</div>
            <h2 id="modal-title">Sucesso!</h2>
            <p id="modal-message">AÃ§Ã£o realizada.</p><button onclick="closeModal()" class="btn-modal">Oba! Entendi</button>
        </div>
    </div>

    <div id="edit-task-modal" class="modal-overlay hidden" onclick="closeEditTaskModal(event)">
        <div class="modal-content" style="border-color: var(--secondary); padding-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: var(--secondary);">âœï¸ Editar Tarefa</h3>
                <button onclick="forceCloseEditTask()" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer; padding: 0;">âœ–</button>
            </div>
            <input type="hidden" id="edit-modal-task-id">
            <input type="text" id="edit-modal-task-desc" placeholder="DescriÃ§Ã£o da Tarefa">
            <input type="text" id="edit-modal-task-val" placeholder="R$ 0,00" oninput="maskCurrency(this)">
            <select id="edit-modal-task-type">
                <option value="false">ğŸš€ Tarefa Extra</option>
                <option value="true">âš¡ ObrigatÃ³ria (DiÃ¡ria)</option>
            </select>
            <button onclick="saveEditedTask()" class="btn-action" style="background: var(--secondary); margin-top: 15px;">Salvar AlteraÃ§Ãµes</button>
        </div>
    </div>

    <div id="terms-modal" class="modal-overlay hidden">
        <div class="modal-content terms-content">
            <h2 style="color: var(--primary);">Termos de Uso</h2>
            <div class="terms-text">
                <p><strong>1. AceitaÃ§Ã£o</strong><br>Ao usar o Cofre MÃ¡gico da Franz TI Services, o responsÃ¡vel concorda com a LGPD.</p>
                <p><strong>2. Coleta de Dados (Pais)</strong><br>Coletamos IP, dispositivo e uso para mÃ©tricas e melhorias.</p>
                <p><strong>3. Finalidade e MonetizaÃ§Ã£o</strong><br>Dados analÃ­ticos dos Pais podem ser usados para envio de ofertas parceiras ou inteligÃªncia de mercado.</p>
                <p><strong>4. ProteÃ§Ã£o de Menores (Art. 14 LGPD)</strong><br>Nenhum dado das crianÃ§as serÃ¡ vendido, repassado ou usado para publicidade.</p>
            </div><button onclick="closeTerms()" class="btn-action" style="margin-top: 20px;">Fechar e Voltar</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>