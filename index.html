<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cofre MÃ¡gico Kids ğŸš—</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FFD700">
    <link rel="apple-touch-icon" href="tarefinhas.png">
    <link rel="icon" type="image/png" href="tarefinhas.png">

    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div id="install-banner" class="hidden" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; padding: 15px 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(108, 92, 231, 0.5); z-index: 9999; display: flex; align-items: center; justify-content: space-between;">
        <div onclick="triggerInstall()" style="flex: 1; cursor: pointer; text-align: left;">
            <strong style="display: block; font-size: 16px; margin-bottom: 3px;">ğŸ“² Instalar o Aplicativo</strong>
            <span style="font-size: 13px; opacity: 0.9;">Tenha o Cofre MÃ¡gico na tela do celular!</span>
        </div>
        <button onclick="closeInstallBanner()" style="background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 16px; display: flex; align-items: center; justify-content: center; padding: 0; margin-left: 15px; box-shadow: none;">âœ–</button>
    </div>

    <div id="app">
        <section id="login-screen" class="card">
            <h1>ğŸŒŸ Cofre MÃ¡gico</h1>
            <div id="login-form">
                <input type="text" id="user" placeholder="E-mail do Pai ou Login do Filho" autocapitalize="none">
                <input type="password" id="pass" placeholder="Senha">
                <button onclick="handleLogin()" class="btn-login" id="btn-login-text">Entrar</button>

                <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px;">
                    <a href="#" onclick="openForgotPassword()" style="color: #666; text-decoration: underline;">Esqueci a senha</a>
                    <a href="#" onclick="toggleSignup()" style="color: var(--secondary); font-weight: bold;">Criar Conta</a>
                </div>
            </div>

            <div id="signup-form" class="hidden">
                <h3 style="color: var(--secondary);">Criar Conta de Pai/MÃ£e</h3>
                <input type="text" id="new-parent-name" placeholder="Seu Nome Completo">
                <input type="email" id="new-parent-email" placeholder="Seu E-mail" autocapitalize="none">
                <input type="text" id="new-parent-phone" placeholder="Seu Telefone / WhatsApp">
                <input type="password" id="new-parent-pass" placeholder="Crie uma Senha (mÃ­nimo 6 letras)">

                <div class="terms-check">
                    <input type="checkbox" id="accept-terms">
                    <label for="accept-terms">Li e concordo com os <a href="termos.html" target="_blank" style="color: var(--primary);">Termos de Uso</a>.</label>
                </div>

                <button onclick="registerParent()" class="btn-action">Solicitar Acesso</button>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    JÃ¡ tem conta? <a href="#" onclick="toggleSignup()" style="color: var(--danger);">Voltar ao Login</a>
                </p>
            </div>
            <p id="login-error" class="error hidden">Erro</p>
        </section>

        <section id="admin-panel" class="hidden card">
            <div class="top-bar">
                <h2>ğŸ‘¨â€ğŸ« Painel</h2>
                <button onclick="logout()" class="btn-logout">Sair ğŸšª</button>
            </div>

            <div class="tabs">
                <button id="btn-tab-filhos" onclick="switchTab('filhos')" class="tab-active">ğŸ‘¶ Meus Filhos</button>
                <button id="btn-tab-tarefas" onclick="switchTab('tarefas')">ğŸ“‹ Tarefas</button>
                <button id="btn-tab-superadmin" onclick="switchTab('superadmin')" class="hidden" style="color: purple; font-weight: bold;">ğŸ‘‘ Admin</button>
            </div>

            <div id="tab-superadmin" class="tab-content hidden">
                <div class="admin-section" style="background: #f3e5f5; border: 2px dashed purple;">
                    <h3 style="color: purple; margin-bottom: 5px;">ğŸ‘‘ GestÃ£o de Clientes</h3>
                    <p class="subtitle">Aprove, bloqueie ou atualize o contato dos pais cadastrados.</p>
                    <div id="all-parents-list" style="margin-top: 15px;"></div>
                </div>
            </div>

            <div id="tab-filhos" class="tab-content">
                <div class="admin-section">
                    <h3>â• Adicionar Filho</h3>
                    <input type="text" id="add-kid-name" placeholder="Nome da crianÃ§a">
                    <input type="text" id="add-kid-login" placeholder="Login para ela acessar" autocapitalize="none">
                    <input type="password" id="add-kid-pass" placeholder="Senha da crianÃ§a">
                    <button onclick="addKid()" class="btn-action">Criar Cofre</button>
                </div>

                <div class="admin-section" style="background: #fff; border: 2px dashed #ccc;">
                    <h3>âš™ï¸ Gerenciar Cofres</h3>
                    <select id="kid-selector" onchange="loadKidDataForAdmin()">
                        <option value="">Selecione um filho...</option>
                    </select>

                    <div id="admin-kid-details" class="hidden">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div class="balance-card" style="flex: 1; margin: 0; padding: 10px;">
                                <span style="font-size: 14px; color:#666; display:block;">Total Guardado:</span>
                                <span id="admin-total-money" style="font-size: 20px;">R$ 0,00</span>
                            </div>
                            <div class="balance-card" style="flex: 1; margin: 0; padding: 10px; background: #fff3e0; border-color: #ff9800; color: #ff9800;">
                                <span style="font-size: 14px; color:#666; display:block;">Ganhos do MÃªs:</span>
                                <span id="admin-month-money" style="font-size: 20px;">R$ 0,00</span>
                            </div>
                        </div>

                        <button onclick="openYearlyReport()" class="btn-action" style="background: #8e44ad; width: 100%; margin-bottom: 20px;">ğŸ“Š Ver HistÃ³rico Completo</button>

                        <div class="admin-section" style="background: #fdfdfd; border: 1px solid #ddd; margin-bottom: 20px;">
                            <h4 style="margin-top:0;">âœï¸ Editar Dados do Filho</h4>
                            <input type="text" id="edit-kid-name" placeholder="Nome da CrianÃ§a">
                            <input type="text" id="edit-kid-login" placeholder="Novo Login" autocapitalize="none">
                            <input type="text" id="edit-kid-pass" placeholder="Nova Senha">
                            <button onclick="updateKidData()" id="btn-update-kid" class="btn-action" style="background: var(--primary); color: #333;">Salvar AlteraÃ§Ãµes</button>
                        </div>

                        <div class="penalty-group">
                            <h4>âš ï¸ Dar Penalidade RÃ¡pida</h4>
                            <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                                <button onclick="applyPenaltyBtn('Bater no irmÃ£o', 2.00)" class="btn-danger" style="margin:0; text-align: left; padding: 10px;">Bater no irmÃ£o (-R$ 2,00)</button>
                                <button onclick="applyPenaltyBtn('Gritar ou responder com grosseria', 1.00)" class="btn-danger" style="margin:0; text-align: left; padding: 10px;">Gritar ou responder com grosseria (-R$ 1,00)</button>
                                <button onclick="applyPenaltyBtn('NÃ£o obedecer de primeira', 0.50)" class="btn-danger" style="margin:0; text-align: left; padding: 10px;">NÃ£o obedecer de primeira (-R$ 0,50)</button>
                                <button onclick="applyPenaltyBtn('Brinquedos espalhados no fim do dia', 0.50)" class="btn-danger" style="margin:0; text-align: left; padding: 10px;">Brinquedos espalhados (-R$ 0,50)</button>
                                <button onclick="applyPenaltyBtn('Falar palavrÃ£o/nome feio', 1.00)" class="btn-danger" style="margin:0; text-align: left; padding: 10px;">Falar palavrÃ£o/nome feio (-R$ 1,00)</button>
                                <button onclick="applyPenaltyBtn('Usar telas fora do horÃ¡rio', 1.50)" class="btn-danger" style="margin:0; text-align: left; padding: 10px;">Usar telas fora do horÃ¡rio (-R$ 1,50)</button>
                            </div>
                            <p style="font-size: 13px; color: #666; margin-bottom: 5px;">Outro motivo (Personalizado):</p>
                            <input type="text" id="penalty-desc" placeholder="Motivo">
                            <input type="text" id="penalty-val" placeholder="R$ 0,00" oninput="maskCurrency(this)">
                            <button onclick="applyPenaltyCustom()" class="btn-danger">Aplicar Desconto Personalizado</button>
                        </div>

                        <div class="history-group" style="margin-top: 20px;">
                            <h4>ğŸ“œ HistÃ³rico de Hoje:</h4>
                            <div id="admin-daily-log" class="log-section"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-tarefas" class="tab-content hidden">
                <div class="admin-section" style="background: #e8f5e9;">
                    <h3 id="task-form-title">ğŸ“‹ Criar/Editar Tarefa</h3>
                    <input type="hidden" id="edit-task-id">
                    <input type="text" id="new-task-desc" placeholder="Ex: Arrumar a cama">
                    <input type="text" id="new-task-val" placeholder="R$ 0,00" oninput="maskCurrency(this)">
                    <select id="new-task-type">
                        <option value="false">ğŸš€ Tarefa Extra</option>
                        <option value="true">âš¡ ObrigatÃ³ria (DiÃ¡ria)</option>
                    </select>
                    <button onclick="saveAdminTask()" id="btn-save-task" class="btn-action" style="background: var(--secondary);">Salvar Tarefa</button>
                    <button onclick="cancelEditTask()" id="btn-cancel-task" class="btn-danger hidden">Cancelar EdiÃ§Ã£o</button>
                </div>
                <div style="text-align: left;">
                    <h4>Suas Tarefas Cadastradas:</h4>
                    <ul id="admin-task-list" style="list-style: none; padding: 0;"></ul>
                </div>
            </div>
        </section>

        <section id="filho-panel" class="hidden card">
            <div class="top-bar">
                <h2 id="filho-welcome">OlÃ¡! ğŸ†</h2>
                <button onclick="logout()" class="btn-logout">Sair ğŸšª</button>
            </div>
            <div class="balance-card">Meu Dinheirinho: <span id="total-money">R$ 0,00</span></div>

            <div id="penalty-section" class="task-section hidden" style="border-color: var(--danger);">
                <h3 style="color: var(--danger);">âš ï¸ O que preciso melhorar:</h3>
                <div id="penalty-list"></div>
            </div>
            <div id="history-section" class="task-section hidden" style="border-color: var(--secondary);">
                <h3 style="color: var(--secondary);">âœ… O que eu jÃ¡ fiz hoje:</h3>
                <div id="filho-daily-log"></div>
            </div>

            <div class="task-section">
                <h3>1. ObrigatÃ³rias âš¡</h3>
                <div id="obligatory-tasks"></div>
            </div>
            <div id="extra-section" class="task-section locked">
                <h3>2. Extras e Ajuda ğŸš€</h3>
                <div id="extra-tasks"></div>
            </div>
        </section>

        <footer class="app-footer">
            <p>&copy; 2026 Franz TI Services. Todos os direitos reservados.</p>
            <p><a href="termos.html" target="_blank" style="color: #888; text-decoration: underline;">Termos de Uso e Privacidade</a></p>
            <a href="https://wa.me/5563981171079" target="_blank" class="btn-support" id="btn-support">ğŸ§ Falar com Suporte</a>
        </footer>
    </div>

    <button id="btn-top" onclick="scrollToTop()">â¬†ï¸</button>

    <div id="custom-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="modal-icon" class="modal-icon">âœ¨</div>
            <h2 id="modal-title">Sucesso!</h2>
            <p id="modal-message">AÃ§Ã£o realizada.</p><button onclick="closeModal()" class="btn-modal">Oba! Entendi</button>
        </div>
    </div>

    <div id="forgot-password-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 style="color: var(--danger);">Esqueci a Senha</h2>
            <p>Digite seu e-mail de cadastro. Enviaremos um link mÃ¡gico para vocÃª criar uma nova senha.</p>
            <input type="email" id="reset-email-input" placeholder="Seu E-mail" autocapitalize="none">
            <button onclick="sendPasswordReset()" class="btn-action" style="background: var(--danger);">Enviar Link de RecuperaÃ§Ã£o</button>
            <button onclick="closeForgotPassword()" class="btn-back">Cancelar</button>
        </div>
    </div>

    <div id="update-password-modal" class="modal-overlay hidden">
        <div class="modal-content" style="border-color: var(--secondary);">
            <h2 style="color: var(--secondary);">ğŸ”‘ Criar Nova Senha</h2>
            <p>Bem-vindo de volta! Digite a sua nova senha abaixo.</p>
            <input type="password" id="new-password-input" placeholder="Nova Senha (mÃ­nimo 6 letras)">
            <button onclick="saveNewPassword()" class="btn-action" style="background: var(--secondary);">Atualizar Senha</button>
        </div>
    </div>

    <div id="yearly-report-modal" class="modal-overlay hidden">
        <div class="modal-content" style="border-color: #8e44ad; max-width: 450px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h2 style="color: #8e44ad; font-size: 20px; margin: 0;">ğŸ“Š HistÃ³rico</h2>
                <button onclick="closeYearlyReport()" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer; padding: 0;">âœ–</button>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #eee; border-radius: 10px; padding: 5px;">
                <button onclick="changeReportYear(-1)" style="width: auto; background: none; border: none; font-size: 20px; box-shadow: none;">â—€</button>
                <strong id="report-year-display" style="font-size: 18px;">2026</strong>
                <button onclick="changeReportYear(1)" style="width: auto; background: none; border: none; font-size: 20px; box-shadow: none;">â–¶</button>
            </div>
            <div id="yearly-report-content" style="text-align: left; max-height: 40vh; overflow-y: auto; margin-bottom: 15px; padding-right: 5px;"></div>
            <div style="font-size: 18px; font-weight: bold; color: #333; border-top: 2px dashed #ddd; padding-top: 10px;">
                Ganho Total no Ano: <br><span id="yearly-total-money" style="color: var(--secondary); font-size: 24px;">R$ 0,00</span>
            </div>
        </div>
    </div>

    <div id="edit-task-modal" class="modal-overlay hidden" onclick="closeEditTaskModal(event)">
        <div class="modal-content" style="border-color: var(--secondary); padding-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: var(--secondary);">âœï¸ Editar Tarefa</h3>
                <button onclick="forceCloseEditTask()" style="background: none; border: none; font-size: 20px; color: #999; cursor: pointer; padding: 0;">âœ–</button>
            </div>
            <input type="hidden" id="edit-modal-task-id">
            <input type="text" id="edit-modal-task-desc" placeholder="DescriÃ§Ã£o da Tarefa">
            <input type="text" id="edit-modal-task-val" placeholder="R$ 0,00" oninput="maskCurrency(this)">
            <select id="edit-modal-task-type">
                <option value="false">ğŸš€ Tarefa Extra</option>
                <option value="true">âš¡ ObrigatÃ³ria (DiÃ¡ria)</option>
            </select>
            <button onclick="saveEditedTask()" class="btn-action" style="background: var(--secondary); margin-top: 15px;">Salvar AlteraÃ§Ãµes</button>
        </div>
    </div>

    <div id="edit-parent-modal" class="modal-overlay hidden">
        <div class="modal-content" style="border-color: purple; padding-top: 15px;">
            <h3 style="color: purple; margin-top:0;">âœï¸ Atualizar Cliente</h3>
            <p id="edit-parent-email-display" style="font-size: 14px; font-weight: bold; margin-bottom: 15px; color: #333;"></p>
            <input type="hidden" id="edit-parent-id">
            <input type="text" id="edit-parent-name" placeholder="Nome Completo">
            <input type="text" id="edit-parent-phone" placeholder="Novo Telefone / WhatsApp">
            <button onclick="saveParentEdit()" class="btn-action" style="background: purple; margin-top: 15px;">Salvar Dados</button>
            <button onclick="closeEditParentModal()" class="btn-back">Cancelar</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js'); }); }
    </script>
</body>

</html>